<?php

require 'vendor/autoload.php';

use PHPUnit\Framework\TestCase;

class GetAddressClientTest extends TestCase
{
    /**
     * Tests that attempting to instantiate GetAddressClient with an empty apiKey throws an error
     *
     * @expectedException        Exception
     * @expectedExceptionMessage No apiKey provided
     */
    public function testWithoutApikey()
    {
        $client = new \petelawrence\getaddress\GetAddressClient('');
    }


    /**
     * Tests the lookup function with an invalid apiKey
     *
     * @expectedException        \petelawrence\getaddress\GetAddressAuthenticationException
     */
    public function testLookupWithInvalidApikey()
    {
        $client = new \petelawrence\getaddress\GetAddressClient('fooo');
        $client->lookup('NR10 4JJ');
    }


    public function testParseResponse()
    {
        $client = new \petelawrence\getaddress\GetAddressClient('fooo');
        $response = $this->getSampleResponse();

        $result = $client->parseResponse($response);

        $this->checkResultObject($result);
    }


    /**
     * Tests the lookup function with just a postcode
     *
     * @depends testParseResponse
     */
    public function testLookup()
    {
        $result = $this->getAuthenicatedClient()->lookup('NR10 4JJ');

        $this->checkResultObject($result);
    }


    /**
     * Tests the lookup function with an invalid postcode
     *
     * @expectedException \petelawrence\getaddress\GetAddressLookupException
     */
    public function testInvalidLookup()
    {
        $this->getAuthenicatedClient()->lookup('XX10 4JJ');
    }



    private function getSampleResponse()
    {
        //Example JSON for a lookup of 'NR10 4JJ'
        return '{"result":[{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Bircham Centre","udprn":17409025,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"1J","line_1":"Bircham Centre","line_2":"Market Place","line_3":"Reepham","premise":"","longitude":1.1114133,"latitude":52.7623997,"eastings":610027,"northings":322847,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"200002759305","id":"paf_17409025","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Butler Castell","udprn":51135865,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"3G","line_1":"Butler Castell","line_2":"Market Place","line_3":"Reepham","premise":"","longitude":1.1111078,"latitude":52.7622728,"eastings":610007,"northings":322832,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091315255","id":"paf_51135865","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Hotbrand","udprn":57789255,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"3Y","line_1":"Hotbrand","line_2":"Market Place","line_3":"Reepham","premise":"","longitude":1.1111078,"latitude":52.7622728,"eastings":610007,"northings":322832,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091315255","id":"paf_57789255","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Kings Arms","udprn":17409041,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"3T","line_1":"Kings Arms","line_2":"Market Place","line_3":"Reepham","premise":"","longitude":1.1111078,"latitude":52.7622728,"eastings":610007,"northings":322832,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091315255","id":"paf_17409041","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Motts Pharmacy","udprn":17409040,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"3S","line_1":"Motts Pharmacy","line_2":"Market Place","line_3":"Reepham","premise":"","longitude":1.110739,"latitude":52.7627142,"eastings":609980,"northings":322880,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"200001508353","id":"paf_17409040","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Parsons & Co","udprn":53840701,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"3R","line_1":"Parsons & Co","line_2":"Market Place","line_3":"Reepham","premise":"","longitude":1.1104077,"latitude":52.7626419,"eastings":609958,"northings":322871,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091542865","id":"paf_53840701","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Reepham Beauty Therapy","udprn":51134850,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"3D","line_1":"Reepham Beauty Therapy","line_2":"Market Place","line_3":"Reepham","premise":"","longitude":1.1102604,"latitude":52.7624479,"eastings":609949,"northings":322849,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"10014352341","id":"paf_51134850","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Reepham Library","udprn":17409044,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"1W","line_1":"Reepham Library","line_2":"Market Place","line_3":"Reepham","premise":"","longitude":1.1114133,"latitude":52.7623997,"eastings":610027,"northings":322847,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091543059","id":"paf_17409044","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Robertsons Butchers","udprn":51135861,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"3E","line_1":"Robertsons Butchers","line_2":"Market Place","line_3":"Reepham","premise":"","longitude":1.1107435,"latitude":52.762777,"eastings":609980,"northings":322887,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091642594","id":"paf_51135861","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"The Dial House","udprn":17409046,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"2R","line_1":"The Dial House","line_2":"Market Place","line_3":"Reepham","premise":"","longitude":1.1111892,"latitude":52.7629991,"eastings":610009,"northings":322913,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"200004284248","id":"paf_17409046","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Very Nice Things","udprn":51135863,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"3F","line_1":"Very Nice Things","line_2":"Market Place","line_3":"Reepham","premise":"","longitude":1.1118827,"latitude":52.7624616,"eastings":610058,"northings":322855,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"200004284238","id":"paf_51135863","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Bank House","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409023,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1D","line_1":"Bank House","line_2":"Market Place","line_3":"Reepham","premise":"Bank House","longitude":1.110692,"latitude":52.7626794,"eastings":609977,"northings":322876,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091542818","id":"paf_17409023","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Breese Coach House","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409027,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1E","line_1":"Breese Coach House","line_2":"Market Place","line_3":"Reepham","premise":"Breese Coach House","longitude":1.1117472,"latitude":52.7625078,"eastings":610049,"northings":322860,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091542819","id":"paf_17409027","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Carlton House","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409029,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1F","line_1":"Carlton House","line_2":"Market Place","line_3":"Reepham","premise":"Carlton House","longitude":1.1115882,"latitude":52.7627728,"eastings":610037,"northings":322889,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091542820","id":"paf_17409029","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Finchley Cottage","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409035,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1H","line_1":"Finchley Cottage","line_2":"Market Place","line_3":"Reepham","premise":"Finchley Cottage","longitude":1.1104571,"latitude":52.7629194,"eastings":609960,"northings":322902,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091315251","id":"paf_17409035","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Girton House","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Kings Opticians & Audiologists","udprn":57907989,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"3Z","line_1":"Kings Opticians & Audiologists","line_2":"Girton House","line_3":"Market Place, Reepham","premise":"Girton House","longitude":1.111515,"latitude":52.7625822,"eastings":610033,"northings":322868,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"10096120447","id":"paf_57907989","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Hewkes House","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409038,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1L","line_1":"Hewkes House","line_2":"Market Place","line_3":"Reepham","premise":"Hewkes House","longitude":1.1115574,"latitude":52.7625488,"eastings":610036,"northings":322864,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091315253","id":"paf_17409038","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Hideaway Cottage","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409039,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1N","line_1":"Hideaway Cottage","line_2":"Market Place","line_3":"Reepham","premise":"Hideaway Cottage","longitude":1.1122823,"latitude":52.7629435,"eastings":610083,"northings":322910,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091315254","id":"paf_17409039","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Iona","sub_building_name":"","po_box":"","department_name":"","organisation_name":"Barber On The Square","udprn":57786767,"postcode_type":"S","su_organisation_indicator":"Y","delivery_point_suffix":"3W","line_1":"Barber On The Square","line_2":"Iona","line_3":"Market Place, Reepham","premise":"Iona","longitude":1.110692,"latitude":52.7626794,"eastings":609977,"northings":322876,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091613274","id":"paf_57786767","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Iona","sub_building_name":"Basement Flat","po_box":"","department_name":"","organisation_name":"","udprn":17409024,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"3U","line_1":"Basement Flat","line_2":"Iona","line_3":"Market Place, Reepham","premise":"Basement Flat, Iona","longitude":1.110642,"latitude":52.762393,"eastings":609975,"northings":322844,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091315249","id":"paf_17409024","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Iona","sub_building_name":"Middle Flat","po_box":"","department_name":"","organisation_name":"","udprn":17409043,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"2G","line_1":"Middle Flat","line_2":"Iona","line_3":"Market Place, Reepham","premise":"Middle Flat, Iona","longitude":1.1106407,"latitude":52.762375,"eastings":609975,"northings":322842,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"200004288851","id":"paf_17409043","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Iona","sub_building_name":"Top Flat","po_box":"","department_name":"","organisation_name":"","udprn":17409053,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"2U","line_1":"Top Flat","line_2":"Iona","line_3":"Market Place, Reepham","premise":"Top Flat, Iona","longitude":1.110642,"latitude":52.762393,"eastings":609975,"northings":322844,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091543042","id":"paf_17409053","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Ivy House","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":53691788,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"3Q","line_1":"Ivy House","line_2":"Market Place","line_3":"Reepham","premise":"Ivy House","longitude":1.1105397,"latitude":52.7624136,"eastings":609968,"northings":322846,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"10014353394","id":"paf_53691788","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Melton House","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409042,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1Q","line_1":"Melton House","line_2":"Market Place","line_3":"Reepham","premise":"Melton House","longitude":1.1115882,"latitude":52.7627728,"eastings":610037,"northings":322889,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091542820","id":"paf_17409042","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Old Telephone Exchange","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409047,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"2F","line_1":"Old Telephone Exchange","line_2":"Market Place","line_3":"Reepham","premise":"Old Telephone Exchange","longitude":1.1105113,"latitude":52.7626392,"eastings":609965,"northings":322871,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091315258","id":"paf_17409047","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Queen Cottage","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":51793341,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"3L","line_1":"Queen Cottage","line_2":"Market Place","line_3":"Reepham","premise":"Queen Cottage","longitude":1.1105608,"latitude":52.7627098,"eastings":609968,"northings":322879,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"10014351428","id":"paf_51793341","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Riches House","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409048,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1X","line_1":"Riches House","line_2":"Market Place","line_3":"Reepham","premise":"Riches House","longitude":1.1118913,"latitude":52.7624501,"eastings":610059,"northings":322854,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091642597","id":"paf_17409048","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"St. Johns Alley","sub_building_name":"Quidsin","po_box":"","department_name":"","organisation_name":"","udprn":52115523,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"3N","line_1":"Quidsin","line_2":"St. Johns Alley","line_3":"Market Place, Reepham","premise":"Quidsin, St. Johns Alley","longitude":1.1119291,"latitude":52.7629797,"eastings":610059,"northings":322913,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"200004462773","id":"paf_52115523","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"St. Michaels House","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409051,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1R","line_1":"St. Michaels House","line_2":"Market Place","line_3":"Reepham","premise":"St. Michaels House","longitude":1.1120355,"latitude":52.7623924,"eastings":610069,"northings":322848,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091315262","id":"paf_17409051","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Sun House","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409028,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"2Q","line_1":"Sun House","line_2":"Market Place","line_3":"Reepham","premise":"Sun House","longitude":1.1103164,"latitude":52.7624015,"eastings":609953,"northings":322844,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091642598","id":"paf_17409028","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Sun House","sub_building_name":"Flat 1","po_box":"","department_name":"","organisation_name":"","udprn":17409036,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"2X","line_1":"Flat 1","line_2":"Sun House","line_3":"Market Place, Reepham","premise":"Flat 1, Sun House","longitude":1.1103164,"latitude":52.7624015,"eastings":609953,"northings":322844,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091542695","id":"paf_17409036","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Sun House","sub_building_name":"Flat 2","po_box":"","department_name":"","organisation_name":"","udprn":17409037,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1S","line_1":"Flat 2","line_2":"Sun House","line_3":"Market Place, Reepham","premise":"Flat 2, Sun House","longitude":1.1103164,"latitude":52.7624015,"eastings":609953,"northings":322844,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091542822","id":"paf_17409037","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Sun House","sub_building_name":"Flat 3","po_box":"","department_name":"","organisation_name":"","udprn":51135878,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"3J","line_1":"Flat 3","line_2":"Sun House","line_3":"Market Place, Reepham","premise":"Flat 3, Sun House","longitude":1.1103164,"latitude":52.7624015,"eastings":609953,"northings":322844,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"200004287738","id":"paf_51135878","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Sun House","sub_building_name":"Flat 4","po_box":"","department_name":"","organisation_name":"","udprn":51135868,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"3H","line_1":"Flat 4","line_2":"Sun House","line_3":"Market Place, Reepham","premise":"Flat 4, Sun House","longitude":1.1102746,"latitude":52.7624386,"eastings":609950,"northings":322848,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"200004287739","id":"paf_51135868","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"Sun House","sub_building_name":"Flat 5","po_box":"","department_name":"","organisation_name":"","udprn":51134849,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"3B","line_1":"Flat 5","line_2":"Sun House","line_3":"Market Place, Reepham","premise":"Flat 5, Sun House","longitude":1.1102894,"latitude":52.7624382,"eastings":609951,"northings":322848,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"200004287740","id":"paf_51134849","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"The Chimes","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409030,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1T","line_1":"The Chimes","line_2":"Market Place","line_3":"Reepham","premise":"The Chimes","longitude":1.1108226,"latitude":52.7628469,"eastings":609985,"northings":322895,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091315263","id":"paf_17409030","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"The Chimes","sub_building_name":"Flat","po_box":"","department_name":"","organisation_name":"","udprn":17409033,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"2T","line_1":"Flat","line_2":"The Chimes","line_3":"Market Place, Reepham","premise":"Flat, The Chimes","longitude":1.1108226,"latitude":52.7628469,"eastings":609985,"northings":322895,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"200002759303","id":"paf_17409033","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"","building_name":"The Old Bakery","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409045,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"2E","line_1":"The Old Bakery","line_2":"Market Place","line_3":"Reepham","premise":"The Old Bakery","longitude":1.1114003,"latitude":52.7628407,"eastings":610024,"northings":322896,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091315264","id":"paf_17409045","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"7","building_name":"","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409054,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"1A","line_1":"7 Market Place","line_2":"Reepham","line_3":"","premise":"7","longitude":1.1107694,"latitude":52.7623087,"eastings":609984,"northings":322835,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100090814021","id":"paf_17409054","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"8","building_name":"","sub_building_name":"Flat","po_box":"","department_name":"","organisation_name":"","udprn":17409034,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"3A","line_1":"Flat","line_2":"8 Market Place","line_3":"Reepham","premise":"Flat, 8","longitude":1.1107275,"latitude":52.7623457,"eastings":609981,"northings":322839,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"200004288850","id":"paf_17409034","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"},{"postcode":"NR10 4JJ","postcode_inward":"4JJ","postcode_outward":"NR10","post_town":"Norwich","dependant_locality":"Reepham","double_dependant_locality":"","thoroughfare":"Market Place","dependant_thoroughfare":"","building_number":"8","building_name":"Diannes Pantry","sub_building_name":"","po_box":"","department_name":"","organisation_name":"","udprn":17409031,"postcode_type":"S","su_organisation_indicator":"","delivery_point_suffix":"2W","line_1":"Diannes Pantry","line_2":"8 Market Place","line_3":"Reepham","premise":"Diannes Pantry, 8","longitude":1.1107275,"latitude":52.7623457,"eastings":609981,"northings":322839,"country":"England","traditional_county":"Norfolk","administrative_county":"Norfolk","postal_county":"Norfolk","county":"Norfolk","district":"Broadland","ward":"Reepham","uprn":"100091543051","id":"paf_17409031","country_iso":"GBR","country_iso_2":"GB","county_code":"","language":"en","umprn":"","dataset":"paf"}],"code":2000,"message":"Success","limit":100,"page":0,"total":41}';
    }

    private function checkResultObject($result)
    {
        $this->assertInstanceOf('\petelawrence\getaddress\GetAddressResponse', $result);
        $this->assertEquals('52.7623997', $result->getLatitude());
        $this->assertEquals('1.1114133', $result->getLongitude());
        $this->assertTrue(is_array($result->getAddresses()));

        //Check that the address fields have been correctly set
        $address0 = $result->getAddresses()[0];
        $this->assertEquals('Bircham Centre', $address0->getLine1());
        $this->assertEquals('Market Place', $address0->getLine2());
        $this->assertEquals('', $address0->getLine3());
        $this->assertEquals('', $address0->getLine4());
        $this->assertEquals('Reepham', $address0->getTown());
        $this->assertEquals('Norwich', $address0->getPostalTown());
        $this->assertEquals('Norfolk', $address0->getCounty());
    }


    /**
     * Returns a GetAddressClient with a valid key (assuming a valid one has been supplied)
     *
     * @return [type] [description]
     */
    private function getAuthenicatedClient()
    {
        $apiKey = getenv('GETADDRESSKEY');

        if (!$apiKey) {
            $this->markTestIncomplete('No api key has been set, so unable to test against Ideal Postcodes');
            return;
        }

        return new \petelawrence\getaddress\GetAddressClient($apiKey);
    }
}
